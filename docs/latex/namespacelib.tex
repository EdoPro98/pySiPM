\hypertarget{namespacelib}{}\doxysection{lib Namespace Reference}
\label{namespacelib}\index{lib@{lib}}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
def \mbox{\hyperlink{namespacelib_a629737e676aeb2b460569a22ac6574d0}{add\+D\+CR}} (rate)
\begin{DoxyCompactList}\small\item\em Generation of dark count events. \end{DoxyCompactList}\item 
def \mbox{\hyperlink{namespacelib_ab1e3459a02ac6f86b2ed0c424c7b025d}{Hit\+Cells}} (n)
\begin{DoxyCompactList}\small\item\em Generation of cell I\+Ds. \end{DoxyCompactList}\item 
def \mbox{\hyperlink{namespacelib_aeef8a5575c78b94cbad58d261a3330e5}{add\+XT}} (times, idx, xt)
\begin{DoxyCompactList}\small\item\em Generation of optical crosstalk events. \end{DoxyCompactList}\item 
def \mbox{\hyperlink{namespacelib_a525d82714cff07b58269022959bf9756}{add\+AP}} (times, h, ap)
\begin{DoxyCompactList}\small\item\em Generation of afterpulses. \end{DoxyCompactList}\item 
def \mbox{\hyperlink{namespacelib_aed915ea4d029c2e44e081d667223b829}{Si\+P\+M\+Event\+Action}} (times, idx, debug=False)
\begin{DoxyCompactList}\small\item\em Calculates relative signal height for each photoelectron. \end{DoxyCompactList}\item 
def \mbox{\hyperlink{namespacelib_afb486e4454d4d7fdebaab37f3aed3cf8}{Si\+P\+M\+Signal\+Action}} (times, sigH, snr=S\+NR, basespread=0)
\begin{DoxyCompactList}\small\item\em Generation of full Si\+PM signal. \end{DoxyCompactList}\item 
def \mbox{\hyperlink{namespacelib_a12b418ca90859c8d09ace22a4b6426a5}{Pulse\+C\+PU}} (t, h)
\begin{DoxyCompactList}\small\item\em Generation of single cell signals. \end{DoxyCompactList}\item 
def \mbox{\hyperlink{namespacelib_a25b9afd12b6e9267bcc13567edddf946}{signal\+Analysis}} (signal, intstart, intgate, threshold, debug=False)
\begin{DoxyCompactList}\small\item\em Features extraction from signals. \end{DoxyCompactList}\item 
def \mbox{\hyperlink{namespacelib_a8b73eb3ac209e7c6d7f8754ff3131fb2}{somestats}} (output, realpe=None)
\begin{DoxyCompactList}\small\item\em Function that displays histograms of generated events. \end{DoxyCompactList}\item 
def \mbox{\hyperlink{namespacelib_a5b7fb9c244a8faf479618c130a01bd44}{sig\+Plot}} (signal, npe, ndcr, dev)
\begin{DoxyCompactList}\small\item\em Plot each signal pulse produced in the simulation. \end{DoxyCompactList}\item 
def \mbox{\hyperlink{namespacelib_a291fd9533c302e20ead86796bbda9841}{initialize\+Random\+Pool}} (seed=None)
\begin{DoxyCompactList}\small\item\em Function that initializes random seeds for each worker in the multiprocessing Pool. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{namespacelib_a474dee6130f5d04c01b4cae4475ac8ab}\label{namespacelib_a474dee6130f5d04c01b4cae4475ac8ab}} 
\mbox{\hyperlink{namespacelib_a474dee6130f5d04c01b4cae4475ac8ab}{signalmodel}} = fsignal(0, TF, TR, P\+E\+A\+K\+R\+A\+T\+IO, S\+I\+G\+P\+TS)
\begin{DoxyCompactList}\small\item\em Array containing the signal shape of the Si\+PM intended as the ideal signal generated by a signle photoelectron at time 0 ns. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
\begin{DoxyVerb}In this file I define all the functions I will use in the main file of simulation.\end{DoxyVerb}
 

\doxysubsection{Function Documentation}
\mbox{\Hypertarget{namespacelib_a525d82714cff07b58269022959bf9756}\label{namespacelib_a525d82714cff07b58269022959bf9756}} 
\index{lib@{lib}!addAP@{addAP}}
\index{addAP@{addAP}!lib@{lib}}
\doxysubsubsection{\texorpdfstring{addAP()}{addAP()}}
{\footnotesize\ttfamily def lib.\+add\+AP (\begin{DoxyParamCaption}\item[{}]{times,  }\item[{}]{h,  }\item[{}]{ap }\end{DoxyParamCaption})}



Generation of afterpulses. 

Function that generates afterpulses(\+A\+P) events and adds them to the list of events to simulate. Each avalanche generates a poissonian number of AP events. A\+Ps are delayed from teyr main signal following a fast and slow exponential distributions. Theyr relative signal height is calculated consdering the cell recovery time as an RC circuit\+: \[h=1-e^{-\frac{\Delta_t}{\tau}}\] 
\begin{DoxyParams}{Parameters}
{\em times} & List containing the time at which Si\+PM cells are fired, including D\+CR and XT events. \\
\hline
{\em h} & List containing the relative signal height of each fired cell. \\
\hline
{\em ap} & Value (probability) of AP events. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
times\+: List containing the time at which Si\+PM cells are fired, including AP events. 

h\+: List containing the relative signal height of each hitted cell. 

n\+Ap\+: Number of Ap events generated. 
\end{DoxyReturn}


Definition at line 91 of file lib.\+py.

\mbox{\Hypertarget{namespacelib_a629737e676aeb2b460569a22ac6574d0}\label{namespacelib_a629737e676aeb2b460569a22ac6574d0}} 
\index{lib@{lib}!addDCR@{addDCR}}
\index{addDCR@{addDCR}!lib@{lib}}
\doxysubsubsection{\texorpdfstring{addDCR()}{addDCR()}}
{\footnotesize\ttfamily def lib.\+add\+D\+CR (\begin{DoxyParamCaption}\item[{}]{rate }\end{DoxyParamCaption})}



Generation of dark count events. 

Function that generates times for dark count events (D\+CR). Events are generated as an uniform poisson process, hence the time distance between consecutive D\+CR events follows an exponential distribution with a mean value of\+: $\tau=\frac{1}{DCR}$ 
\begin{DoxyParams}{Parameters}
{\em rate} & Dark counts rate un Hz. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
dcr\+Time\+: List containing times of D\+CR events in ns. 

n\+Dcr\+: Number of D\+CR events generated 
\end{DoxyReturn}


Definition at line 14 of file lib.\+py.

\mbox{\Hypertarget{namespacelib_aeef8a5575c78b94cbad58d261a3330e5}\label{namespacelib_aeef8a5575c78b94cbad58d261a3330e5}} 
\index{lib@{lib}!addXT@{addXT}}
\index{addXT@{addXT}!lib@{lib}}
\doxysubsubsection{\texorpdfstring{addXT()}{addXT()}}
{\footnotesize\ttfamily def lib.\+add\+XT (\begin{DoxyParamCaption}\item[{}]{times,  }\item[{}]{idx,  }\item[{}]{xt }\end{DoxyParamCaption})}



Generation of optical crosstalk events. 

Function that generates optical crosstalk events(\+X\+T). Each photoelectron has generates a poissonian number of XT events accordingly to the crosstalk probability. XT events are generated in the 8 neighbouring cells and have the same time of the main cell.~\newline
 XT events can also generate other XT events in theyr neighbouring cells. 
\begin{DoxyParams}{Parameters}
{\em times} & List containing the time of each Si\+PM cell avalanche, including D\+CR events. \\
\hline
{\em idx} & List containing the ID of each fired cell. \\
\hline
{\em xt} & Value (probability) of XT events. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
times\+: List containing the time at which Si\+PM cells are fired including XT events 

idx\+: List containing the ID of the hitted cells including XT events. 

n\+Xt\+: Number of Xt events generated. 
\end{DoxyReturn}


Definition at line 55 of file lib.\+py.

\mbox{\Hypertarget{namespacelib_ab1e3459a02ac6f86b2ed0c424c7b025d}\label{namespacelib_ab1e3459a02ac6f86b2ed0c424c7b025d}} 
\index{lib@{lib}!HitCells@{HitCells}}
\index{HitCells@{HitCells}!lib@{lib}}
\doxysubsubsection{\texorpdfstring{HitCells()}{HitCells()}}
{\footnotesize\ttfamily def lib.\+Hit\+Cells (\begin{DoxyParamCaption}\item[{}]{n }\end{DoxyParamCaption})}



Generation of cell I\+Ds. 

Function that generated cell I\+Ds for each photoelectron in the list.~\newline
 Cell I\+Ds are integers in range \mbox{[}0 -\/ N\+C\+E\+L\+LS\mbox{]} and are generated randomly. An ID can appear multiple times, meaning that the corresponding cell has generated an avalanche due to a photoelectron multiple times. 
\begin{DoxyParams}{Parameters}
{\em n} & Number of photoelectrons that have to be simulated. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
idx\+: List containing the ID of each hitted cell. 
\end{DoxyReturn}


Definition at line 39 of file lib.\+py.

\mbox{\Hypertarget{namespacelib_a291fd9533c302e20ead86796bbda9841}\label{namespacelib_a291fd9533c302e20ead86796bbda9841}} 
\index{lib@{lib}!initializeRandomPool@{initializeRandomPool}}
\index{initializeRandomPool@{initializeRandomPool}!lib@{lib}}
\doxysubsubsection{\texorpdfstring{initializeRandomPool()}{initializeRandomPool()}}
{\footnotesize\ttfamily def lib.\+initialize\+Random\+Pool (\begin{DoxyParamCaption}\item[{}]{seed = {\ttfamily None} }\end{DoxyParamCaption})}



Function that initializes random seeds for each worker in the multiprocessing Pool. 

This function extracts seeds using os.\+urandom, so from the operating system entropy pool, and uses the to set the seeds for the random generator and numpy random generator. Seeds need to be different for each worker, otherwise the random values are generate equally among workers. 

Definition at line 440 of file lib.\+py.

\mbox{\Hypertarget{namespacelib_a12b418ca90859c8d09ace22a4b6426a5}\label{namespacelib_a12b418ca90859c8d09ace22a4b6426a5}} 
\index{lib@{lib}!PulseCPU@{PulseCPU}}
\index{PulseCPU@{PulseCPU}!lib@{lib}}
\doxysubsubsection{\texorpdfstring{PulseCPU()}{PulseCPU()}}
{\footnotesize\ttfamily def lib.\+Pulse\+C\+PU (\begin{DoxyParamCaption}\item[{}]{t,  }\item[{}]{h }\end{DoxyParamCaption})}



Generation of single cell signals. 

Function that generates the signal from a single Si\+PM cell. This is the \char`\"{}fast\char`\"{} version that uses a pre-\/computed signal shape and moves it in the \char`\"{}right\char`\"{} position in time. 
\begin{DoxyParams}{Parameters}
{\em t} & Time at which the cell is triggered. \\
\hline
{\em h} & The relative pulse height of the cell signal \\
\hline
{\em gainvar} & Value of cell to cell gain variation for this signal. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
s\+: Array containing the generated cell signal 
\end{DoxyReturn}


Definition at line 225 of file lib.\+py.

\mbox{\Hypertarget{namespacelib_a25b9afd12b6e9267bcc13567edddf946}\label{namespacelib_a25b9afd12b6e9267bcc13567edddf946}} 
\index{lib@{lib}!signalAnalysis@{signalAnalysis}}
\index{signalAnalysis@{signalAnalysis}!lib@{lib}}
\doxysubsubsection{\texorpdfstring{signalAnalysis()}{signalAnalysis()}}
{\footnotesize\ttfamily def lib.\+signal\+Analysis (\begin{DoxyParamCaption}\item[{}]{signal,  }\item[{}]{intstart,  }\item[{}]{intgate,  }\item[{}]{threshold,  }\item[{}]{debug = {\ttfamily False} }\end{DoxyParamCaption})}



Features extraction from signals. 

Function that extracts some simple features from signals considering an integration gate. At the moment the features considered are\+:
\begin{DoxyItemize}
\item Peak\+: signal peak in the integration gate.
\item Integral\+: sum of samples in the integration gate corrected by the sampling time.
\item Time of Arrival\+: time position of the first sample above the threshold.
\item Time over Threshold\+: Number fo samples above the threshold corrected by the sampling time.
\item Time of Peak\+: time position of the sample in the peak. This list might be expanded in future with more complex features. 
\begin{DoxyParams}{Parameters}
{\em signal} & Array containing the digitized signal. \\
\hline
{\em intstart} & Integer value containing the index corresponding to the start of the integration gate. \\
\hline
{\em intgate} & Integer value containing the lenght of the integration gate in units of samples. \\
\hline
{\em threshold} & Threshold used to calculate the values described above. It is automatically set to 1.\+5 times the single photoelectron peak height. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Returns the features extracted. If thesignal is below the threshold all features are set to -\/1. 
\end{DoxyReturn}

\end{DoxyItemize}

Definition at line 251 of file lib.\+py.

\mbox{\Hypertarget{namespacelib_a5b7fb9c244a8faf479618c130a01bd44}\label{namespacelib_a5b7fb9c244a8faf479618c130a01bd44}} 
\index{lib@{lib}!sigPlot@{sigPlot}}
\index{sigPlot@{sigPlot}!lib@{lib}}
\doxysubsubsection{\texorpdfstring{sigPlot()}{sigPlot()}}
{\footnotesize\ttfamily def lib.\+sig\+Plot (\begin{DoxyParamCaption}\item[{}]{signal,  }\item[{}]{npe,  }\item[{}]{ndcr,  }\item[{}]{dev }\end{DoxyParamCaption})}



Plot each signal pulse produced in the simulation. 

Function used for debug purposes only. It creates a window for each worker and draws the signals as they are generated. 
\begin{DoxyParams}{Parameters}
{\em signal} & Array containing the generated Si\+PM signal. \\
\hline
{\em npe} & Total number of hitted cells. \\
\hline
{\em ndcr} & Total number of D\+CR events. \\
\hline
{\em dev} & String that describes the device on which the signal is computed. (cpu / cpu-\/fast / gpu) \\
\hline
\end{DoxyParams}


Definition at line 379 of file lib.\+py.

\mbox{\Hypertarget{namespacelib_aed915ea4d029c2e44e081d667223b829}\label{namespacelib_aed915ea4d029c2e44e081d667223b829}} 
\index{lib@{lib}!SiPMEventAction@{SiPMEventAction}}
\index{SiPMEventAction@{SiPMEventAction}!lib@{lib}}
\doxysubsubsection{\texorpdfstring{SiPMEventAction()}{SiPMEventAction()}}
{\footnotesize\ttfamily def lib.\+Si\+P\+M\+Event\+Action (\begin{DoxyParamCaption}\item[{}]{times,  }\item[{}]{idx,  }\item[{}]{debug = {\ttfamily False} }\end{DoxyParamCaption})}



Calculates relative signal height for each photoelectron. 

Since a Si\+PM cell may be hitted multiple times, recovery time has to be considered. If all cell I\+Ds are different all signal heights are left unchanged with a value of 1, else if an ID appears multiple times then the first (in time) hit gives a signal height of 1 and the following will have a lower relative height. The relative signal height, after a $\Delta_t$ time from the previous hit, is calculated supposing that each Si\+PM cell recovers as an RC circuit\+: \[h(\Delta_t)=1-e^{-\frac{t}{\tau}}\] 
\begin{DoxyParams}{Parameters}
{\em times} & List containing the time of all events that have generated an avalanche in the Si\+PM cells. \\
\hline
{\em idx} & List containing the corresponding cell I\+Ds of the events. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
h\+: List containing the relative signal height of each avalanche. 
\end{DoxyReturn}


Definition at line 134 of file lib.\+py.

\mbox{\Hypertarget{namespacelib_afb486e4454d4d7fdebaab37f3aed3cf8}\label{namespacelib_afb486e4454d4d7fdebaab37f3aed3cf8}} 
\index{lib@{lib}!SiPMSignalAction@{SiPMSignalAction}}
\index{SiPMSignalAction@{SiPMSignalAction}!lib@{lib}}
\doxysubsubsection{\texorpdfstring{SiPMSignalAction()}{SiPMSignalAction()}}
{\footnotesize\ttfamily def lib.\+Si\+P\+M\+Signal\+Action (\begin{DoxyParamCaption}\item[{}]{times,  }\item[{}]{sigH,  }\item[{}]{snr = {\ttfamily SNR},  }\item[{}]{basespread = {\ttfamily 0} }\end{DoxyParamCaption})}



Generation of full Si\+PM signal. 

Function that generates the full Si\+PM signal as the sum of the signals of each cell starting from gaussian noise. 
\begin{DoxyParams}{Parameters}
{\em times} & List containing the time at wich Si\+PM cells are fired, including D\+CR, XT and AP events \\
\hline
{\em sigH} & List containing the correspondin relative pulse height of each fired cell. \\
\hline
{\em snr} & Signal to noise ratio converted into the R\+MS of the gaussian noise. \\
\hline
{\em basespread} & Sigma of the value to add as baseline spread. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
signal\+: Array containing the complete sigitized Si\+PM signal. 
\end{DoxyReturn}


Definition at line 183 of file lib.\+py.

\mbox{\Hypertarget{namespacelib_a8b73eb3ac209e7c6d7f8754ff3131fb2}\label{namespacelib_a8b73eb3ac209e7c6d7f8754ff3131fb2}} 
\index{lib@{lib}!somestats@{somestats}}
\index{somestats@{somestats}!lib@{lib}}
\doxysubsubsection{\texorpdfstring{somestats()}{somestats()}}
{\footnotesize\ttfamily def lib.\+somestats (\begin{DoxyParamCaption}\item[{}]{output,  }\item[{}]{realpe = {\ttfamily None} }\end{DoxyParamCaption})}



Function that displays histograms of generated events. 


\begin{DoxyParams}{Parameters}
{\em output} & Array containing the signal features. \\
\hline
{\em realpe} & Optional parameter. Array containing the real number of photoelectrons given to the simulation. \\
\hline
\end{DoxyParams}
\begin{DoxySeeAlso}{See also}
\mbox{\hyperlink{namespacelib_a25b9afd12b6e9267bcc13567edddf946}{signal\+Analysis}} for a description of the signal features. 
\end{DoxySeeAlso}


Definition at line 293 of file lib.\+py.

